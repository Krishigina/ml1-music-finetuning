# Классификация музыкальных инструментов с Transfer Learning

Проект для классификации изображений музыкальных инструментов с использованием глубокого обучения. Реализует transfer learning с предобученными моделями (ResNet18, EfficientNet-B0), экспорт в ONNX и веб-приложение для инференса.

## Описание задачи

Этот проект решает задачу классификации изображений музыкальных инструментов на три класса:
- **Арфа (Harp)** - струнный щипковый инструмент
- **Пианино (Piano)** - клавишный инструмент  
- **Скрипка (Violin)** - струнный смычковый инструмент

Основная цель — разработать и обучить модель машинного обучения, способную точно классифицировать изображения музыкальных инструментов для автоматизации их идентификации.

## Структура проекта

```
├── README.md                    <- Основная документация проекта
├── experiments/                 <- Эксперименты и обучение моделей
│   ├── config.py               <- Конфигурации для обучения
│   ├── train.py                <- Скрипт обучения моделей
│   ├── requirements.txt        <- Зависимости для обучения
│   ├── data/                   <- Данные для обучения
│   │   └── raw/                <- Исходные изображения по классам
│   │       ├── harp/           <- Изображения арф (40 шт.)
│   │       ├── piano/          <- Изображения пианино (40 шт.)
│   │       └── violin/         <- Изображения скрипок (40 шт.)
│   ├── models/                 <- Обученные модели и артефакты
│   │   ├── best_model.onnx     <- Лучшая модель в формате ONNX
│   │   ├── best_model.pth      <- Лучшая модель PyTorch
│   │   └── *.pth               <- Другие обученные модели
│   ├── notebooks/              <- Jupyter ноутбуки для экспериментов
│   │   └── experiments_main.ipynb
│   └── reports/                <- Отчеты и визуализации
│       └── figures/            <- Графики и диаграммы
│
└── web_application/            <- Веб-приложение для инференса
    ├── app.py                  <- Gradio приложение
    └── requirements.txt        <- Зависимости для веб-приложения
```

## Набор данных

### Характеристики данных
- **Размер**: 120 изображений (40 на каждый класс)
- **Формат**: RGB изображения различных размеров
- **Источник**: Собраны вручную из открытых источников
- **Разнообразие**: Различные ракурсы, освещение, фоны

### Предобработка данных
- Изменение размера до 224×224 пикселей
- Нормализация по статистике ImageNet
- Аугментация данных для обучающей выборки:
  - Случайные повороты (15°)
  - Горизонтальные отражения (50%)
  - Изменение яркости, контрастности, насыщенности (20%)

Подробнее см. `experiments/data/raw/README.md`

## Быстрый старт

### 1. Настройка среды для обучения
```bash
cd experiments
python -m venv .venv
source .venv/bin/activate  # На Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

### 2. Обучение модели
**Важно**: Перед началом обучения обязательно перейдите в папку `experiments`:
```bash
cd experiments
```

Затем запустите скрипт обучения:
```bash
# Обучение с конфигурацией по умолчанию (EfficientNet-B0, лучшие параметры)
python train.py

# Обучение ResNet18
python train.py --config resnet

# Обучение EfficientNet-B0
python train.py --config efficientnet
```

### 3. Запуск веб-приложения
```bash
cd ../web_application
python -m venv .venv
source .venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements.txt
python app.py
```

Откройте http://127.0.0.1:7863 в браузере и загрузите изображение для классификации.

## Архитектура и методы

### Модели
- **ResNet18**: Классическая сверточная архитектура
- **EfficientNet-B0**: Современная эффективная архитектура (рекомендуется)

### Transfer Learning
Используется двухэтапный подход:
1. **Этап 1 (3 эпохи)**: Обучение только головы классификатора (backbone заморожен)
   - Learning rate: 1e-3
2. **Этап 2 (7 эпох)**: Полное дообучение всей модели
   - Learning rate: 1e-4

### Оптимизация
- Оптимизатор: Adam
- Функция потерь: CrossEntropyLoss
- Регуляризация: Weight decay (1e-4)


### Экспорт модели
Лучшая модель автоматически экспортируется в формат ONNX для эффективного инференса на CPU.

## Эксперименты и анализ

### Jupyter ноутбуки
```bash
cd experiments
jupyter lab
```

Откройте `notebooks/experiments_main.ipynb` для:
- Исследования данных и визуализации
- Сравнения различных архитектур
- Анализа результатов обучения
- Оценки ONNX модели

### Конфигурации
Все параметры обучения настраиваются в `experiments/config.py`:
- Архитектура модели
- Гиперпараметры обучения
- Параметры аугментации
- Пути к данным

## Веб-приложение

Gradio-приложение предоставляет простой интерфейс для классификации:
- Загрузка изображений через drag-and-drop
- Мгновенная классификация с вероятностями
- Поддержка различных форматов изображений
- Автоматический поиск лучшей модели